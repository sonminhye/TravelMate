<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="travel">
	<!-- 첫 화면에 보여질 6개 -->
	<select id="selectTravel" resultType="hashmap">
		<![CDATA[
			SELECT		t.travelCode, t.userCode, t.title, t.content, t.writeDate
			FROM		travel t
			ORDER BY	t.writeDate DESC, t.travelCode DESC
			LIMIT		0, 6
		]]>
	</select>
	
	<!-- 스크롤을 통해 3개씩 더 가져오기 -->
	<select id="selectTravelScroll" parameterType="int" resultType="hashmap">
		<![CDATA[
			SELECT		t.travelCode, t.userCode, t.title, t.content, t.writeDate
			FROM		travel t
			WHERE		t.travelCode <= #{code}
				AND		t.travelCode > #{code} - 3
			ORDER BY	t.travelCode DESC, t.writeDate DESC
		]]>
	</select>
	
	<select id="selectTravelDetail" parameterType="int" resultType="hashmap">
		<![CDATA[
			SELECT	t.travelCode, t.userCode, t.title, t.content, t.writeDate, td.startDate, td.startTime, td.endDate, td.endTime, td.minPeople, td.maxPeople
			FROM	travel t, traveldetail td
			WHERE	t.travelCode = td.travelCode
				AND	t.travelCode = #{code}
		]]>
	</select>

	<select id="selectTravelRoute" parameterType="int" resultType="hashmap">
		<![CDATA[
			SELECT		tr.lat, tr.lng, tr.location
			FROM		travel t, travelroute tr
			WHERE		t.travelCode = tr.travelCode
				AND		t.travelCode = #{code}
			ORDER BY	tr.location ASC
		]]>
	</select>

	<insert id="insertTravel" parameterType="com.travel.mate.dto.TravelDTO">
		<![CDATA[
			INSERT	INTO
				travel (userCode, title, content, writeDate)
			VALUES
				(#{userCode}, #{title}, #{content}, now())
		]]>
	</insert>
	
	<insert id="insertTravelDetail" parameterType="com.travel.mate.dto.TravelDetailDTO">
		<![CDATA[
			INSERT	INTO
				traveldetail (travelCode, startDate, startTime, endDate, endTime, minPeople, maxPeople)
			VALUES
				((SELECT MAX(travelCode) FROM travel), #{startDate}, #{startTime}, #{endDate}, #{endTime}, #{minPeople}, #{maxPeople})
		]]>
	</insert>

	<insert id="insertTravelRoute" parameterType="com.travel.mate.dto.TravelRouteDTO">
		<![CDATA[
			INSERT	INTO
				travelroute (travelCode, lat, lng, location)
			VALUES
				((SELECT MAX(travelCode) FROM travel), #{lat}, #{lng}, #{location})
		]]>
	</insert>
	
	<insert id="insertTravelImage" parameterType="com.travel.mate.dto.TravelImageDTO">
		<![CDATA[
			INSERT	INTO
				travelimage (travelCode, image)
			VALUES
				((SELECT MAX(travelCode) FROM travel), #{image})
		]]>
	</insert>
</mapper>

